-- Do not break it, just update the params
\copy (SELECT 'INSERT INTO datavalue (dataelementid, periodid, sourceid, categoryoptioncomboid, value, storedby, lastupdated, comment, followup, attributeoptioncomboid, created, deleted) VALUES ((SELECT dataelementid FROM dataelement WHERE uid = ''' || dataelement.uid || '''), (SELECT periodid FROM _periodstructure WHERE iso = ''' || _periodstructure.iso || '''), (SELECT organisationunitid FROM organisationunit WHERE uid = ''' || organisationunit.uid || '''), (SELECT categoryoptioncomboid FROM categoryoptioncombo WHERE uid = ''' || coc1.uid || '''), ''' || REPLACE(datavalue.value, '''', '''''') || ''', ''' || REPLACE(datavalue.storedby, '''', '''''') || ''', ''' || datavalue.lastupdated || ''', ''' || COALESCE(REPLACE(datavalue.comment, '''', ''''''), '') || ''', ' || datavalue.followup || ', (SELECT categoryoptioncomboid FROM categoryoptioncombo WHERE uid = ''' || coc2.uid || '''), ''' || datavalue.created || ''', ' || datavalue.deleted || ') ON CONFLICT (dataelementid, periodid, sourceid, categoryoptioncomboid, attributeoptioncomboid) DO UPDATE SET value = EXCLUDED.value, storedby = EXCLUDED.storedby, lastupdated = EXCLUDED.lastupdated, comment = EXCLUDED.comment, followup = EXCLUDED.followup, created = EXCLUDED.created, deleted = EXCLUDED.deleted;' FROM datavalue INNER JOIN dataelement USING(dataelementid) INNER JOIN _periodstructure ON _periodstructure.periodid = datavalue.periodid INNER JOIN organisationunit ON organisationunit.organisationunitid = datavalue.sourceid INNER JOIN categoryoptioncombo coc1 ON coc1.categoryoptioncomboid = datavalue.categoryoptioncomboid INNER JOIN categoryoptioncombo coc2 ON coc2.categoryoptioncomboid = datavalue.attributeoptioncomboid WHERE datavalue.dataelementid IN (SELECT dataelementid FROM datasetelement WHERE datasetid IN (SELECT datasetid FROM dataset WHERE uid IN ('Pw3c2BcqbQ5','mU6qzGINdKw','RpeHQ2saIRg','cBPkl0M6T9I','cap79mdf6Co'))) AND datavalue.periodid IN (SELECT periodid FROM period WHERE startdate BETWEEN '2022-01-01' AND '2024-12-31')) TO '/tmp/datavalue_rch_inserts.sql'