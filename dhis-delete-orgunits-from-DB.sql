// delete single programUiD with all organisationunits to be deleted [TODO: simplify more by placing where in ('programUID', 'programUID2', ...)]
delete from trackedentitydatavalueaudit where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalue where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalueaudit where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalue where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalueaudit where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk'))and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalue where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk'))and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalueaudit where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk'))and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalue where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk'))and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalueaudit where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalue where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalueaudit where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from trackedentitydatavalue where programstageinstanceid in(select programstageinstanceid from  programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T')));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));
delete from programstageinstance where programstageid in(select programstageid from programstage where programid in(select programid from program where uid='zqVzfifwIYk')) and organisationunitid in(select organisationunitid from organisationunit where uid in('uHp3aLKA6Tn','dMrzB6ZPUWm','w3kw4cQItMK','l5UY5j9L68T'));


-- delete ogranisation units dataValues on all wisn dataSets
delete from datavalueaudit where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
-- delete datavalue orgunits 
delete from datavalue where sourceid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
--  delete organisationunitid on datasetsource table
delete from datasetsource where sourceid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
--  delete organisationunitid on completedatasetregistration table
delete from completedatasetregistration where sourceid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
--  delete organisationunitid on program_organisationunits table
delete from program_organisationunits where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
--  delete organisationunitid on programstageinstance table
delete from programstageinstance where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
--  delete trackedentitydatavalue, trackedentitydatavalueaudit with dependency to organisationunits to be deleted
delete from trackedentitydatavalueaudit where programstageinstanceid in(select programstageinstanceid from  programstageinstance where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44')));
delete from trackedentitydatavalue where programstageinstanceid in(select programstageinstanceid from  programstageinstance where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44')));
--  delete organisationunitid on trackedentityinstance table
delete from trackedentityinstance where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
--  delete organisationunitid on categoryoption_organisationunit table
delete from categoryoption_organisationunits where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
--  dele organisation units on groups
delete from orgunitgroupmembers where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
delete from userdatavieworgunits where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
delete from usermembership where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
delete from visualization_organisationunits where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
delete from eventreport_organisationunits where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
delete from userteisearchorgunits where organisationunitid in(select organisationunitid from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44'));
--  delete actual organisationunits
delete from organisationunit where uid in('lgZ6HfZaj3f','zxSFN22hhaw','khVWfL2AWX3','GlJKnzvoHZw','yC5rHmTfENV','iEIdCVxSJct','x5jqAe0QG44');


// delete WISN-HMIS data
delete from datavalueaudit where dataelementid in(select dataelementid from dataelement where uid in('wisnHmisUid1','wisnHmisUid2'));
delete from datavalue where dataelementid in(select dataelementid from dataelement where uid in('wisnHmisUid1','wisnHmisUid2'));


UPDATE organisationunit SET uid='lgZ6HfZaj3f' where uid='fQyCUoTPROD';
UPDATE organisationunit SET uid='tq4bMQkHDbC' where uid='WvIaGXaCzuV';
UPDATE organisationunit SET uid='iEIdCVxSJct' where uid='QiP3Wq82xzn';
UPDATE organisationunit SET uid='HeESSqNok0X' where uid='ASZSXHlhwwj';



DELETE FROM datavalue where created ilike '%2019%'
DELETE FROM datavalue where created BETWEEN  '2000-01-01' AND '2019-12-31';



SELECT a.name,a.uid,a.organisationunitid,a.parentid
FROM organisationunit a
JOIN (SELECT name, hierarchylevel, parentid, COUNT(*)
FROM organisationunit 
GROUP BY name, hierarchylevel, parentid
HAVING count(*) > 1 ) b
ON a.name = b.name
AND a.hierarchylevel = b.hierarchylevel
AND a.hierarchylevel=4
AND b.hierarchylevel=4
AND a.parentid=b.parentid
ORDER BY a.parentid;

      name       |     uid     | organisationunitid | parentid 
-----------------+-------------+--------------------+----------
 Kinjumbi Ward   | OBVCWRAkXrF |            5902851 |    77637 - DELETED 
 Kinjumbi Ward   | XLEuAWBVIC1 |            4455816 |    77637
 Kawajense Ward  | I9bkMX2I6fY |            5902799 |    79763 - DELETED
 Kawajense Ward  | MbGt0X2wWka |            4458122 |    79763
 Makanyagio Ward | YqgsxNwK5uB |            5903011 |    79763 - DELETED
 Makanyagio Ward | Wl6LR5SRxDJ |            4458124 |    79763
 Mbezi Ward      | TsYxjYGoelU |            5276118 |  4706967
 Mbezi Ward      | dUp0GM6uDcg |            4457987 |  4706967

-- check datavalues count 
select count(*) from datavalue where sourceid=5902851;
select count(*) from trackedentityattributevalue where sourceid=5902851;


select count(*) from datavalue where sourceid in(select organisationunitid from organisationunit where uid='fe8OvIPd75A');
select count(*) from trackedentityattributevalue where sourceid=5902851;

copy(select * from datavalue where sourceid=(select organisationunitid from organisationunit where uid='IfrfalFKbng')) to '/tmp/batch10.csv' with csv header;

update datavalue set sourceid=(select organisationunitid from organisationunit where uid='lvgYm5rutFE') where sourceid=(select organisationunitid from organisationunit where uid='vskJqE5wu1d');
="update datavalue set sourceid=(select organisationunitid from organisationunit where uid='bjrTSfTjQUi') where periodid="&B2&" and sourceid="&C2&";"

5276150

update datavalue set sourceid=(select organisationunitid from organisationunit where uid='O0aG5anXh5A') where periodid=6027268 and sourceid=5276150;

update datavalueaudit set organisationunitid=(select organisationunitid from organisationunit where uid='bjrTSfTjQUi') where organisationunitid=(select organisationunitid from organisationunit where uid='IfrfalFKbng');
update trackedentityinstance set organisationunitid=(select organisationunitid from organisationunit where uid='bjrTSfTjQUi') where organisationunitid=(select organisationunitid from organisationunit where uid='IfrfalFKbng');
update programinstance set organisationunitid=(select organisationunitid from organisationunit where uid='bjrTSfTjQUi') where organisationunitid=(select organisationunitid from organisationunit where uid='IfrfalFKbng');
update programstageinstance set organisationunitid=(select organisationunitid from organisationunit where uid='bjrTSfTjQUi') where organisationunitid=(select organisationunitid from organisationunit where uid='IfrfalFKbng');
update trackedentityprogramowner set organisationunitid=(select organisationunitid from organisationunit where uid='bjrTSfTjQUi') where organisationunitid=(select organisationunitid from organisationunit where uid='IfrfalFKbng');
delete from datavalue where sourceid=(select organisationunitid from organisationunit where uid='IfrfalFKbng');